# Load libraries
library(tidyverse)
library(magrittr)
library(rsample)
library(recipes)


load("dm/data/MLProjectData.RData")
test <- read_csv("dm/data/testData.csv")

glimpse(MLProjectData)
glimpse(test)

MLProjectData %<>% 
  modify_if(is.logical, as.factor) %>% 
  glimpse()


# building recipes ####
# bake a recipe with dummy variables
rec_obj <- recipe(target ~ ., data = MLProjectData)

trained_rec <- rec_obj %>%
  step_knnimpute(all_predictors()) %>% 
  step_dummy(all_predictors(), -all_numeric()) %>% 
  step_center(all_predictors())  %>%
  step_scale(all_predictors()) %>% 
  prep(training = MLProjectData)

train_data <- bake(trained_rec, newdata = MLProjectData)
test_data <- bake(trained_rec, newdata = test.data)


set.seed(123)
valid_split <- initial_split(train_data, .8)



# training data
train_v2 <- analysis(valid_split)
x_train <- train_v2[setdiff(names(train_v2), "target")]
y_train <- train_v2$target

# validation data
valid <- assessment(valid_split)
x_valid <- valid[setdiff(names(valid), "target")]
y_valid <- valid$target


# Summary Stats of all  Variables ####
skimr::skim(MLProjectData)
# Skim summary statistics
# n obs: 6350 
# n variables: 86 
# 
# ── Variable type:factor ────────────────────────────────────────────────────────────────────────────────────────────
# variable missing complete    n n_unique                         top_counts ordered
# cat1       0     6350 6350        5 B: 1303, C: 1303, D: 1279, E: 1271   FALSE
# cat2       0     6350 6350       12     F: 557, H: 554, E: 550, J: 550   FALSE
# 
# ── Variable type:integer ───────────────────────────────────────────────────────────────────────────────────────────
# variable missing complete    n   mean      sd p0     p25    p50     p75 p100     hist
# num59       0     6350 6350 3227.5 1833.23 53 1640.25 3227.5 4814.75 6402 ▇▇▇▇▇▇▇▇
# 
# ── Variable type:logical ───────────────────────────────────────────────────────────────────────────────────────────
# variable missing complete    n   mean                      count
# cat10       0     6350 6350 0.0069  FAL: 6306, TRU: 44, NA: 0
# cat11       0     6350 6350 0.034  FAL: 6131, TRU: 219, NA: 0
# cat12       0     6350 6350 0.044  FAL: 6070, TRU: 280, NA: 0
# cat13       0     6350 6350 0.04   FAL: 6099, TRU: 251, NA: 0
# cat14       0     6350 6350 0.031  FAL: 6156, TRU: 194, NA: 0
# cat15       0     6350 6350 0.0069  FAL: 6306, TRU: 44, NA: 0
# cat16       0     6350 6350 0.0044  FAL: 6322, TRU: 28, NA: 0
# cat17       0     6350 6350 0.025  FAL: 6192, TRU: 158, NA: 0
# cat18       0     6350 6350 0.011   FAL: 6281, TRU: 69, NA: 0
# cat19       0     6350 6350 0.034  FAL: 6131, TRU: 219, NA: 0
# cat20       0     6350 6350 0.044  FAL: 6070, TRU: 280, NA: 0
# cat21       0     6350 6350 0.039  FAL: 6100, TRU: 250, NA: 0
# cat22       0     6350 6350 0.031  FAL: 6156, TRU: 194, NA: 0
# cat23       0     6350 6350 0.0068  FAL: 6307, TRU: 43, NA: 0
# cat24       0     6350 6350 0.0044  FAL: 6322, TRU: 28, NA: 0
# cat25       0     6350 6350 0.025  FAL: 6192, TRU: 158, NA: 0
# cat26       0     6350 6350 0.011   FAL: 6281, TRU: 69, NA: 0
# cat3       0     6350 6350 0.034  FAL: 6131, TRU: 219, NA: 0
# cat4       0     6350 6350 0.044  FAL: 6070, TRU: 280, NA: 0
# cat5       0     6350 6350 0.04   FAL: 6099, TRU: 251, NA: 0
# cat6       0     6350 6350 0.031  FAL: 6156, TRU: 194, NA: 0
# cat7       0     6350 6350 0.025  FAL: 6192, TRU: 158, NA: 0
# cat8       0     6350 6350 0.011   FAL: 6281, TRU: 69, NA: 0
# cat9       0     6350 6350 0.0044  FAL: 6322, TRU: 28, NA: 0
# 
# ── Variable type:numeric ───────────────────────────────────────────────────────────────────────────────────────────
# variable missing complete    n      mean       sd         p0      p25        p50       p75    p100     hist
# num1       0     6350 6350 849.86    1000.22     0.052    68.64     558.72   1250.55   8710.26 ▇▂▁▁▁▁▁▁
# num10       0     6350 6350  19.42       8.14     9.14     13.42      17.54     23.01     80.86 ▇▅▂▁▁▁▁▁
# num11       0     6350 6350  19.42       8.14     9.14     13.42      17.54     23.01     80.86 ▇▅▂▁▁▁▁▁
# num12       0     6350 6350   0.0022     0.068   -0.3      -0.036     -0.0032    0.033     1.16 ▁▇▁▁▁▁▁▁
# num13       0     6350 6350   0.0041     0.094   -0.35     -0.051     -0.0036    0.048     1.77 ▁▇▁▁▁▁▁▁
# num14       0     6350 6350   0.0058     0.11    -0.38     -0.059     -0.0051    0.057     1.76 ▁▇▁▁▁▁▁▁
# num15       0     6350 6350   0.00069    1.57   -17.36     -0.64      -0.05      0.56     20.01 ▁▁▁▇▁▁▁▁
# num16       0     6350 6350   0.00061    1.57   -17.36     -0.64      -0.05      0.56     20.01 ▁▁▁▇▁▁▁▁
# num17       0     6350 6350   0.00066    1.57   -17.36     -0.64      -0.05      0.56     20.01 ▁▁▁▇▁▁▁▁
# num18       0     6350 6350   0.036      1.42   -11.52     -0.55       0.062     0.68     12.85 ▁▁▁▇▃▁▁▁
# num19       0     6350 6350   0.036      1.42   -11.52     -0.55       0.062     0.68     12.85 ▁▁▁▇▃▁▁▁
# num2       0     6350 6350  19.42       8.14     9.14     13.42      17.54     23.01     80.86 ▇▅▂▁▁▁▁▁
# num20       0     6350 6350   0.036      1.42   -11.52     -0.55       0.062     0.68     12.85 ▁▁▁▇▃▁▁▁
# num21       0     6350 6350   0.036      1.42   -11.52     -0.55       0.062     0.68     12.85 ▁▁▁▇▃▁▁▁
# num22       0     6350 6350   0.037      1.42   -11.52     -0.54       0.062     0.68     12.85 ▁▁▁▇▃▁▁▁
# num23       0     6350 6350   0.5        4.55   -33.42     -1.57       0.8       3.15     16.92 ▁▁▁▁▂▇▂▁
# num24       0     6350 6350  50.66       8.3     16.9      45.5       51.24     56.36     75.97 ▁▁▂▅▇▆▂▁
# num25       0     6350 6350  35.52      15.87     5.02     24.14      32.52     43.98    135.46 ▃▇▅▂▁▁▁▁
# num26       0     6350 6350  26.46      17.25     0.00073  12.18      24.49     38.48     84.05 ▇▇▇▆▅▂▁▁
# num27       0     6350 6350  26.46      11.06     7.36     18.06      23.63     33.64     69.66 ▃▇▅▃▂▁▁▁
# num28       0     6350 6350  54.13      11.09    16.7      46.24      54.58     62.24     87.03 ▁▁▃▆▇▆▂▁
# num29       0     6350 6350  52.42      13.32    13.32     42.69      52.04     61.58    100    ▁▂▆▇▆▃▁▁
# num3       0     6350 6350   0.036      1.38   -15.12     -0.53       0.08      0.64      9.53 ▁▁▁▁▇▅▁▁
# num30       0     6350 6350   1.69      38.93  -555.89    -16.29      10.06     29.12     69.58 ▁▁▁▁▁▁▃▇
# num31       0     6350 6350   0.97       1.08     0         0.23       0.68      1.35     14.75 ▇▁▁▁▁▁▁▁
# num32       0     6350 6350   0.97       0.48     0.13      0.67       0.9       1.21      3.43 ▃▇▅▂▁▁▁▁
# num33       0     6350 6350 129.02      53       43.34     96.2      122.98    146.97    285.93 ▃▃▇▅▁▂▁▁
# num34       0     6350 6350 128.05      52.79    43.28     95.06     122       146       284.5  ▃▃▇▃▁▂▁▁
# num35       0     6350 6350   0.19       1.09    -7.52     -0.27       0.36      0.86      2.98 ▁▁▁▁▂▇▇▁
# num36       0     6350 6350   0.19       1.02    -6.86     -0.24       0.34      0.84      2.65 ▁▁▁▁▂▆▇▁
# num37       0     6350 6350   6.27      36.58  -251.93    -10.18      11.18     28.84     99.34 ▁▁▁▁▂▇▇▁
# num38       0     6350 6350   6.27      35.74  -241.7      -9.78      11.02     28.38     95.42 ▁▁▁▁▂▇▇▁
# num39       0     6350 6350  26.46      11.06     7.36     18.06      23.63     33.64     69.66 ▃▇▅▃▂▁▁▁
# num4       0     6350 6350   0.00035    0.012   -0.098    -0.0046 6e-04         0.0057    0.15 ▁▁▂▇▁▁▁▁
# num40       0     6350 6350  52.42      13.32    13.32     42.69      52.05     61.58    100    ▁▂▆▇▆▃▁▁
# num41       0     6350 6350   0.19       1.09    -7.52     -0.27       0.36      0.86      2.98 ▁▁▁▁▂▇▇▁
# num42       0     6350 6350   6.27      36.58  -251.93    -10.18      11.18     28.84     99.34 ▁▁▁▁▂▇▇▁
# num43       0     6350 6350   0.036      1.14    -9.25     -0.44       0.06      0.55     10.63 ▁▁▁▇▂▁▁▁
# num44       0     6350 6350  49.21       8.41    24.37     43.06      48.24     54.52     91.04 ▁▃▇▆▂▁▁▁
# num45       0     6350 6350  -0.17       4.47   -11.19     -3.16      -0.76      2.18     28.97 ▁▇▇▂▁▁▁▁
# num46       0     6350 6350  -0.18       4.04    -9.9      -2.86      -0.6       1.97     22.06 ▁▆▇▃▁▁▁▁
# num47       0     6350 6350  -0.035    152.01  -419.55    -97.7      -15.44     77.25    814.41 ▁▃▇▅▁▁▁▁
# num48       0     6350 6350  -0.11     147.24  -404.17    -95.13     -14.29     74.29    748.02 ▁▃▇▅▁▁▁▁
# num49       0     6350 6350  -0.18       4.47   -11.19     -3.16      -0.77      2.18     28.97 ▁▇▇▂▁▁▁▁
# num5       0     6350 6350   0.00069    0.016   -0.13     -0.0067     0.0013    0.0087    0.13 ▁▁▁▅▇▁▁▁
# num50       0     6350 6350  -0.067    152.01  -419.55    -97.7      -15.44     77.17    814.41 ▁▃▇▅▁▁▁▁
# num51       0     6350 6350  49.21       8.41    24.37     43.06      48.24     54.52     91.04 ▁▃▇▆▂▁▁▁
# num52       0     6350 6350  -0.17       4.47   -11.19     -3.16      -0.76      2.18     28.97 ▁▇▇▂▁▁▁▁
# num53       0     6350 6350  -0.18       4.04    -9.9      -2.86      -0.6       1.97     22.06 ▁▆▇▃▁▁▁▁
# num54       0     6350 6350  -0.035    152.01  -419.55    -97.7      -15.44     77.25    814.41 ▁▃▇▅▁▁▁▁
# num55       0     6350 6350  -0.11     147.24  -404.17    -95.13     -14.29     74.29    748.02 ▁▃▇▅▁▁▁▁
# num56       0     6350 6350  -0.18       4.47   -11.19     -3.16      -0.77      2.18     28.97 ▁▇▇▂▁▁▁▁
# num57       0     6350 6350  -0.067    152.01  -419.55    -97.7      -15.44     77.17    814.41 ▁▃▇▅▁▁▁▁
# num58       0     6350 6350   0.036      1.41   -13.51     -0.58       0.08      0.73     10.83 ▁▁▁▁▇▁▁▁
# num6       0     6350 6350   0.0024     0.027   -0.24     -0.011      0.0041    0.017     0.17 ▁▁▁▁▇▂▁▁
# num7       0     6350 6350   0.0047     0.036   -0.27     -0.013      0.0078    0.025     0.21 ▁▁▁▂▇▂▁▁
# num8       0     6350 6350  19.42       8.14     9.14     13.42      17.54     23.01     80.86 ▇▅▂▁▁▁▁▁
# num9       0     6350 6350  19.42       8.14     9.14     13.42      17.54     23.01     80.86 ▇▅▂▁▁▁▁▁
# target       0     6350 6350  20.04       1.42     8.48     19.45      20.06     20.68     32.85 ▁▁▁▇▃▁▁▁
